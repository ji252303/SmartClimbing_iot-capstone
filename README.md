## 주제: RFID를 이용한 클라이밍 등반 경로 자동 추적 시스템

## 팀원:
- 백인수
- 이우천
- 진가현

## 프로젝트 개요

본 프로젝트는 실내 암벽 등반 중 등반 경로를 자동으로 기록해주는 시스템 제작이다. 사용자는 RFID 리더기가 달린 디바이스를 손목 발목 밴드에 장착하고 등반하면 촬영 등의 별 다른 조치 없이 자동으로 기록된 등반 애니메이션을 앱을 통해 제공 받을 수 있다. 업장 관리자는 이 시스템을 업장에 도입하기 위해 RFID 스티커를 홀드에 붙인 뒤 벽 사진을 찍고 이를 UID 값과 함께 업로드 하기만 하면 쉽게 이용 가능

## 주요 기능 및 전체 시스템 구성

![sol png](https://github.com/ji252303/SmartClimbing_iot_capstone/assets/95694431/bc67b4d0-cbf6-48c9-a793-bdcee95d7e54)

### 주요 기능

- AI 기반 색깔 탐지 기능: 클라이밍 홀드를 색깔별로 탐지하여 관리자로 하여금 간편히 새로운 맵을 데이터베이스에 등록하게 함
- 등반 경로 기록 및 이미지화: 클라이머의 등반 경로를 간단한 이미지 (애니메이션)으로 표현하여 사용자에게 제공함

### 전체 시스템 구성

- 관리자 PC: 실내 암장의 벽 사진을 찍어 웹에 업로드하여 문제별 지도를 생성
- 홀드 객체 탐지 기능
- 홀드 색깔별 구분 기능 (문제 구분)
- Map 이미지 생성 기능
- 사용자 디바이스: RFID 리더기를 내장한 손목 발목 밴드를 착용하여 등반 경로를 기록
- 사용자 앱: 등반 기록을 확인하고 등반 기록이 표시된 이미지 (간단한 애니메이션)을 제공


### 주요 기술

- 객체 탐지 (Yolov8): 클라이밍 홀드를 색깔별로 탐지
- Yolov8 모델이 웹이나 앱에서 구현하기 위한 tflite 파일로 만들어져도 정확도가 크게 감소하지 않아 사용하였다.
- 커스텀 데이터로 훈련시킨 모델이 원하는 색깔만 탐지할 수 있도록 이미지 업로드 전 출력되는 객체정보에서 라벨값만 선택 할 수 있도록 기능을 구현하였다.
- 카메라 마커 (Aruco Marker): 절대좌표 파악
- 사진상의 객체 좌표들로 위치 지도를 구성하면 눈에 보이는것과 달리 불안정하게 위치가 잡힘 이를 해결하고자 카메라 마커를 통해 실제 거리상 좌표를 구해 위치 정확도를 개선하였다.
- OpenCV: 객체의 좌표 데이터를 기반으로 이미지를 시각화
- 이미지를 깔끔하게 표현하고자 사용하였다.
- Flask 웹 프레임워크: 관리자 웹페이지 구성
- 파이썬으로 구현한 기능이 많고 URL을 파이썬 코드 함수나 메서드에 매핑이 가능한 라우팅 매커니즘을 제공하여 사용하였다.
- AWS IoT Core
- 아두이노 디바이스가 인식한 RFID uid 값을 MQTT 통신을 통해 AWS IoT Core의 Device Gateway로 전송한다.
- 수신된 uid 값은 람다 함수의 입력으로 전달되도록 IoT Rule Engine을 설정했다.
- Dynamo DB: 기록과 루트정보저장
- 4개의 아두이노 디바이스가 전송한 RFID uid 값을 timestamp로 정렬하여 저장
- 관리자 웹으로부터 전송받는 좌표값(rxryxy)과 해당 좌표에 대한 홀드 정보(홀드번호 홀드 uid) 저장
- API Gateway
- Rest API를 생성하여 url 엔드포인트를 통해 클라이언트(관리자용 웹 혹은 사용자 어플리케이션)가 리소스에 접근할 수 있도록 구축했다.
- 클라이언트가 Dynamo DB에 저장된 값을 읽어오거나 저장하는 등의 요청을 람다함수의 입력으로 전달함으로써 처리한다.
- Lambda
- 각종 데이터 처리와 저장 API 요청 처리를 위한 함수들을 AWS Lambda로 구현하여 서버리스 환경에서 자동으로 실행되도록 구현했다.
- S3 Bucket
- 관리자 웹 페이지가 생성한 Map 이미지를 저장하고 이를 사용자 어플리케이션에게 제공한다.
- 클라이언트가 S3에 직접 접근하여 이미지 객체를 저장하고 다운로드 할 수 있도록 IAM 사용자에 대한 액세스 키와 액세스 시크릿 키를 발급 받아서 사용했다.
- Android Studio: 사용자 어플리케이션 제작
- 아두이노 디바이스가 전송한 기록이 있는 DB에서 받아온 Json문으로 사용자에게 기록이 포함된 리스트를 보여준다.
- 관리자가 저장한 루트의 정보가 담긴 DB에서 받아온 Json문으로 uid를 대조해 사용자가 태깅안 홀드의 정보를 가져와 정보를 표시해주고 기록된 시간을 바탕으로 간단한 애니메이션을 보여준다.
- S3버킷에 저장된 현재 기록과 일치한 루트의 단순화된 이미지를 가져와 화면에 배치한다.

### 하드웨어

- Arduino Nano 33 IoT Board & PN532 RFID 모듈: 손목 발목 밴드에 RFID 리더기를 내장하여 태깅된 홀드를 인식한다.
- RFID 스티커 태그: 각 홀드에 부착하여 사용하였다.
- 리튬 배터리: 디바이스 전원을 공급한다.

## 기능시연 유튜브 url

[시연 영상](https://youtu.be/PIoj3h1rc8I)






